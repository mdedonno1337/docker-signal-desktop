image: node:12.18.3

stages:
  - build

build:
  stage: build
  script:
    - unset $(compgen -v | grep "CI")
    - env
    - curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | bash
    - apt-get update
    - apt-get install -y jq git-lfs
    - git clone --depth=1 --branch=5.1.x https://github.com/signalapp/Signal-Desktop.git
    - cd Signal-Desktop
    - cat package.json | jq '.build.linux += {target:["deb","AppImage"]}' > with_appimage_package.json
    - mv with_appimage_package.json package.json
    - yarn install
    - yarn build-release
    - ls -la ./release
    - pwd

  artifacts:
    paths:
      - ./Signal-Desktop/release/*.AppImage
        
